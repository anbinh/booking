<!DOCTYPE html>
<script src="/js/hellojs/hello.js"></script>
<script src="/js/hellojs/client_ids.js"></script>


<h1>Load album photos with Hello.js</h1>

<h2>Demo</h2>

<div class="demo">

	<b class="column">Provider</b>
	<b class="column">Albums</b>
	<b class="column">Photos</b>
	<br />
	<div class="column">
		<button id="windows" onclick="getAlbums('windows')">Get Albums from Windows</button>
		<button id="facebook" onclick="getAlbums('facebook')">Get Albums from Facebook</button>
		<button id="google" onclick="getAlbums('google')">Get Albums from Google</button>
		<button id="flickr" onclick="getAlbums('flickr')">Get Albums from Flickr</button>
	</div><div id="albums">
	</div><div id="photos">
	</div>
</div>


<h2>Source</h2>

<p>Include hello.js + modules</p>
<script class="pre" src="/js/hellojs/modules/windows.js"></script>
<script class="pre" src="/js/hellojs/modules/facebook.js"></script>
<script class="pre" src="/js/hellojs/modules/google.js"></script>
<script class="pre" src="/js/hellojs/modules/flickr.js"></script>

<p>Setup a listener</p>

<script class="pre">
// Get User
hello.on('auth.login', function(auth){

	// Get Profile
	hello.api(auth.network+':me', function(r){
		if(!r||r.error){
			return;
		}
		document.getElementById(auth.network).innerHTML = "Get Albums from " + r.name + " at "+auth.network+"";
	});
});
</script>


<h3>Initiate HelloJS</h3>
<p>Plug the app keys (client_id')</p>

<script class="pre">

// Initiate hellojs
//CLIENT_IDS.flickr = FLICKR_CLIENT_ID;
hello.init( CLIENT_IDS_ALL, {
	scope: "files, photos",
	redirect_uri : "redirect.html",
	oauth_proxy : OAUTH_PROXY_URL
});
</script>



<h3>Get Albums</h3>

<script class="pre">

function getAlbums(network){

	// Target where to put the list of albums
	var list = document.getElementById('albums');
	list.innerHTML = ''; // flush its content

	//
	// Setting force:false means we'll only trigger auth flow if the user is not already signed in with the correct credentials
	hello( network ).login({
		force:true
	},function(auth){

		// Get albums
		hello.api( network+':me/albums', function(r){

			if(!r||r.error){
				message(list, "Could not open albums from "+network+", try resigning in");
				return;
			}
			else if(!r.data||r.data.length===0){
				message(list, "There are no albums in the users account");
				return
			}

			// Build buttons with the albums
			for(var i=0;i<r.data.length;i++){
				buildAlbumBtn( r.data[i], network );
			}
		});
	});

}
</script>

<h3>Album button control</h3>

<script class="pre">


// Create a button selecting the album
function buildAlbumBtn(item, network){

	// Target where to put the list of albums
	var list = document.getElementById('albums');

	// construct the button
	var o = document.createElement('button');
	o.innerHTML = item.name;

	// Add the controls
	o.onclick = function(){
		// Trigger get 
		getPhotos( network, item.id );
		//alert(network + item.id);
	};

	// Append to the list
	list.appendChild(o);
}
</script>

<h3>Get Photos</h3>

<script class="pre">

function getPhotos(network, id){

	var list = document.getElementById('photos');
	list.innerHTML = ''; // flush its content

	var path;
	var params;
	if (network == "flickr") {
		path = '/';
		params = {
			method : 'flickr.photosets.getPhotos',
			photoset_id : id,
			format : 'json',
			id: id,
			limit:100
		};
	}

	if (network == "facebook") {
		path = 'me/album';
		params = {
			id: id,
			limit:100
		};
	}

	hello( network ).api(path, params, function(r){
		//alert(JSON.stringify(r));
		if(r.error){
			message(list, r.error.message);
			return;
		}
		else if(!r.data||r.data.length===0){
			message(list, "There are no photos in this album");
			return
		}

		// Create a new image in the DOM, give it some randomness and insert it into the dom.
		for(var i=0;i<r.data.length;i++){
			buildPhotoThumnail( r.data[i] );
		}		
	});
}

</script>

<h3>Create photo thumbnail</h3>

<script class="pre">
function buildPhotoThumnail(item){

	var list = document.getElementById('photos');

	var o = document.createElement('img');
	o.src = item.thumbnail;
	o.title = item.name;

	// Append to the list
	list.appendChild(o);
}

</script>

<script>
// Report any notifications to the containing element
function message(target, str){
	target.appendChild(document.createTextNode(str));
}
</script>

